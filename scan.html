<!doctype html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ScanLink Studio â€” QR Scanner</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>

<style>
body{background:#f4f6fc;font-family:'Poppins';padding-bottom:40px;color:#111}

header{
  background:#fff;padding:14px 22px;
  display:flex;justify-content:space-between;align-items:center;
  box-shadow:0 4px 20px rgba(0,0,0,0.05)
}
.brand{font-size:22px;font-weight:700;color:#0f47d3}
nav a{margin-left:14px;text-decoration:none;color:#111;font-weight:600}

.card{
  max-width:700px;margin:30px auto;
  background:#fff;padding:20px;border-radius:12px;
  box-shadow:0 8px 22px rgba(0,0,0,0.06)
}

.btn{
  padding:10px 16px;border:none;border-radius:10px;
  background:linear-gradient(90deg,#0f47d3,#6a00ff);color:#fff;font-weight:700;cursor:pointer;
}

/* 3D ANIMATION FRAME */
#scannerFrame{
  margin-top:20px;
  width:100%;height:300px;position:relative;
}
#preview{
  width:100%;height:100%;object-fit:cover;border-radius:12px;
}

#border3d{
  position:absolute;top:0;left:0;width:100%;height:100%;
  border:4px solid #0f47d3;border-radius:12px;
  animation:scan 2s infinite linear;
}
@keyframes scan{
  0%{transform:rotateY(0deg);}
  50%{transform:rotateY(180deg);}
  100%{transform:rotateY(360deg);}
}

/* RESULT */
#resultBox{
  background:#eef3ff;padding:12px;border-radius:10px;margin-top:14px;display:none;
}
.openBtn{margin-top:8px;background:#10b981;}
.copyBtn{margin-top:8px;background:#ff9800;}

input[type=file]{
  padding:10px;border-radius:8px;border:1px solid #ccc;width:100%;
}
</style>
</head>

<body>

<header>
  <div class="brand">ScanLink Studio</div>
  <nav>
    <a href="index.html">Home</a>
  </nav>
</header>

<div class="card">
  <h2 style="color:#0f47d3">QR Scanner</h2>

  <button id="startCam" class="btn">Start Camera Scan</button>

  <div id="scannerFrame">
    <video id="preview" autoplay playsinline></video>
    <div id="border3d"></div>
  </div>

  <h3 style="margin-top:20px;color:#0f47d3">Upload QR Image</h3>
  <input id="upload" type="file" accept="image/*">

  <div id="resultBox">
    <h3 style="color:#0f47d3">Result:</h3>
    <div id="resultText"></div>
    <button id="openBtn" class="btn openBtn" style="display:none">Open Link</button>
    <button id="copyBtn" class="btn copyBtn">Copy</button>
  </div>
</div>

<script>
let video=document.getElementById("preview");
let resultBox=document.getElementById("resultBox");
let resultText=document.getElementById("resultText");
let openBtn=document.getElementById("openBtn");
let stream;

// START CAMERA
document.getElementById("startCam").addEventListener("click",async()=>{
  if(stream) stopCam();
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
    video.srcObject = stream;
    scanLoop();
  }catch(e){
    alert("Camera not available");
  }
});

// CAMERA QR SCAN
function scanLoop(){
  let c=document.createElement("canvas");
  let ctx=c.getContext("2d");

  function tick(){
    if(!stream) return;
    if(video.readyState===video.HAVE_ENOUGH_DATA){
      c.width=video.videoWidth;
      c.height=video.videoHeight;
      ctx.drawImage(video,0,0);

      let img=ctx.getImageData(0,0,c.width,c.height);
      let code=jsQR(img.data,c.width,c.height);

      if(code){
        showResult(code.data);
        stopCam();
        return;
      }
    }
    requestAnimationFrame(tick);
  }
  tick();
}

// UPLOAD SCAN
document.getElementById("upload").addEventListener("change", function(){
  let file=this.files[0];
  if(!file) return;

  let reader=new FileReader();
  reader.onload=ev=>{
    let img=new Image();
    img.onload=()=>{
      let c=document.createElement("canvas");
      let ctx=c.getContext("2d");
      c.width=img.width; c.height=img.height;
      ctx.drawImage(img,0,0);

      let id=ctx.getImageData(0,0,c.width,c.height);
      let code=jsQR(id.data,c.width,c.height);

      if(code){
        showResult(code.data);
      }else alert("No QR found");
    };
    img.src=ev.target.result;
  };
  reader.readAsDataURL(file);
});

// SHOW RESULT + LINK BUTTON
function showResult(text){
  resultBox.style.display="block";
  resultText.textContent=text;

  if(text.startsWith("http://") || text.startsWith("https://")){
    openBtn.style.display="block";
    openBtn.onclick=()=> window.open(text,"_blank");
  } else {
    openBtn.style.display="none";
  }
}

// COPY RESULT
document.getElementById("copyBtn").addEventListener("click",()=>{
  navigator.clipboard.writeText(resultText.textContent);
  alert("Copied!");
});

// STOP CAMERA
function stopCam(){
  if(stream){
    stream.getTracks().forEach(t=>t.stop());
    stream=null;
  }
}
</script>

</body>
</html>
